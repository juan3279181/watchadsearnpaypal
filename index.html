<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Notcoin - Watch Ads & Earn Coins</title>

  <!-- Ad Scripts -->
  <script>(function(s){s.dataset.zone='10039693',s.src='https://groleegni.net/vignette.min.js'})([document.documentElement, document.body].filter(Boolean).pop().appendChild(document.createElement('script')))</script>
  <script src="https://fpyf8.com/88/tag.min.js" data-zone="178019" async></script>

  <style>
    /* Your existing CSS styles here */
    body { font-family: Arial, sans-serif; background: #111; color: #fff; margin: 0; padding: 0; overflow-x: hidden; }
    header, footer { background: #000; padding: 1em; text-align: center; }
    .container { width: 95%; max-width: 600px; margin: 0 auto; padding: 10px; }
    .card { background: #1e1e1e; border-radius: 12px; padding: 20px; margin-bottom: 15px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
    button { background: orange; color: black; border: none; border-radius: 8px; padding: 12px 25px; cursor: pointer; font-weight: bold; margin: 5px; transition: transform 0.1s; }
    button:hover:not(:disabled) { transform: scale(1.05); }
    input { border-radius: 8px; border: none; padding: 10px; width: 90%; max-width: 400px; margin: 5px 0; }
    #withdrawResult { margin-top: 10px; color: #ddd; }
  </style>
</head>

<body>
  <header>
    <h1>Notcoin</h1>
    <p>Watch Ads & Earn Coins</p>
  </header>

  <div class="container">
    <div class="card">
      <h2>Your Balance</h2>
      <h1 id="balance">0 Coins</h1>
    </div>

    <div class="card">
      <h3>Daily Tasks</h3>
      <p>Watch ads or play mini-games to earn rewards.</p>
      <div>
        <button id="watchAd">üé¨ Watch Short Ad</button>
        <button id="clickReward">üòé Click for Reward</button>
        <button id="playMini">üéÆ Play Mini App</button>
      </div>
    </div>

    <div class="card">
      <h3>Withdraw Earnings</h3>
      <p>Minimum withdrawal: 25,000 Coins = ‚Çπ20</p>
      <div>
        <input type="number" id="coinAmount" placeholder="Enter Coin Amount"/>
        <input type="email" id="paypalEmail" placeholder="Enter PayPal Email"/>
        <button id="requestWithdrawal">Request PayPal Withdrawal</button>
        <div id="withdrawResult"></div>
      </div>
    </div>
  </div>

  <footer>
    <p>¬© 2025 Notcoin ‚Äî Earn rewards by watching ads</p>
  </footer>

  <script>
    let coins = 10950;
    const balanceEl = document.getElementById('balance');
    balanceEl.innerText = coins + ' Coins';
    
    function updateBalanceDisplay() { 
      balanceEl.innerText = coins + ' Coins'; 
    }

    // Ad earning functions (your existing ad code)
    document.getElementById('watchAd').onclick = () => {
      coins += 200;
      updateBalanceDisplay();
      alert('‚úÖ You earned 200 coins!');
    };

    document.getElementById('clickReward').onclick = () => {
      coins += 30;
      updateBalanceDisplay();
      alert('‚úÖ You earned 30 coins!');
    };

    document.getElementById('playMini').onclick = () => {
      coins += 500;
      updateBalanceDisplay();
      alert('‚úÖ You earned 500 coins!');
    };

    // PayPal Payout Function - UPDATED FOR NETLIFY
    async function processPayPalPayout(email, amountInINR) {
      try {
        const response = await fetch('https://watchadsearnpaypal.onrender.com/api/payout', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            email: email,
            amount: amountInINR,
            currency: 'INR',
            userId: 'user123'
          })
        });

        const data = await response.json();
        
        if (data.success) {
          return { success: true, data: data };
        } else {
          return { success: false, error: data.message || 'Payout failed' };
        }
      } catch (error) {
        console.error('PayPal Payout Error:', error);
        return { success: false, error: 'Network error processing payout' };
      }
    }

    // Coin to INR conversion rate
    const COIN_TO_INR_RATE = 20 / 25000;

    // Withdrawal Logic
    document.getElementById('requestWithdrawal').onclick = async ()=>{
      const coinAmount = Number(document.getElementById('coinAmount').value || 0);
      const paypalEmail = document.getElementById('paypalEmail').value.trim();
      const resultEl = document.getElementById('withdrawResult'); 
      
      resultEl.textContent = '';
      resultEl.style.color = '#ddd';

      // Validation
      if(!coinAmount || coinAmount < 25000){ 
        resultEl.textContent='Minimum withdrawal is 25,000 coins.'; 
        resultEl.style.color = 'orange';
        return; 
      }
      if(coinAmount > coins){ 
        resultEl.textContent='Insufficient balance.'; 
        resultEl.style.color = 'orange';
        return; 
      }
      if(!paypalEmail){ 
        resultEl.textContent='Enter your PayPal email address.'; 
        resultEl.style.color = 'orange';
        return; 
      }

      resultEl.textContent='Processing PayPal withdrawal...';
      resultEl.style.color = 'yellow';

      try {
        const amountInINR = coinAmount * COIN_TO_INR_RATE;
        const payoutResult = await processPayPalPayout(paypalEmail, amountInINR);
        
        if (payoutResult.success) {
          coins -= coinAmount;
          updateBalanceDisplay();
          resultEl.textContent = `‚úÖ Withdrawal successful! ‚Çπ${amountInINR.toFixed(2)} sent to ${paypalEmail}. Funds will arrive in 1-24 hours.`;
          resultEl.style.color = 'lightgreen';
          
          document.getElementById('coinAmount').value = '';
          document.getElementById('paypalEmail').value = '';
        } else {
          resultEl.textContent = `‚ùå Error: ${payoutResult.error}`;
          resultEl.style.color = 'red';
        }
      } catch(err) { 
        console.error('Withdrawal Error:', err); 
        resultEl.textContent = '‚ùå Network error. Try deploying to Netlify instead of GitHub Pages.'; 
        resultEl.style.color = 'red';
      }
    };
  </script>
</body>
</html>
